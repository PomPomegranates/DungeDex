@page "/login"
@using System.Security.Claims
@inject CustomAuthenticationService AuthService
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

<AuthorizeView>
    <Authorized>
        <p>Hello, @context.User.Identity?.Name!</p>
    </Authorized>
    <NotAuthorized>
        <p>You're not logged in.</p>
        <input @bind="userName" />
        <input @bind="password" />
        <button @onclick="SignIn">Sign in</button>
    </NotAuthorized>
</AuthorizeView>

@code {
    [CascadingParameter]
    public AuthenticationState authenticationState { get; set; } = null!;

    public string userName = string.Empty;
    public string password = string.Empty;

    private async Task SignIn()
    {
        using var client = new HttpClient();
        var result = await client.PostAsJsonAsync<LoginModel>("https://localhost:7298/api/authentication/login", new(userName, password));

        if (result.IsSuccessStatusCode)
        {
            var jwt = await result.Content.ReadFromJsonAsync<Jwt>();

        }

    }

    public class LoginModel(string username, string password)
    {
        public string Username = username;
        public string Password = password;
    }

    public class Jwt()
    {
        public string Token { get; set; } = null!;
    }
}